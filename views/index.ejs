<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="css/stylesHomePage.css" />
  <link rel="icon" href="img/favicon.png" type="image/x-icon" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <title>SociAlly</title>
</head>

<body>
  <nav class="navbar navbar-expand sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand ms-2" href="#">soci<span>Ally</span></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <ul class="navbar-nav ms-auto mb-lg-0">
        <li class="nav-item me-2">
          <a class="nav-link active" aria-current="page" href="">Home</a>
        </li>
        <li class="nav-item me-2">
          <a class="nav-link" href="/about">About Us</a>
        </li>
        <li class="nav-item me-4">
          <button type="button" class="btn btn-outline-light sign-up" onclick="location.href='/login/'">
            Sign Up
          </button>
          <div class="login-options">
            <div onclick="location.href='/login/'">As a volunteer</div>
            <div>As a NGO</div>
          </div>
        </li>
        <li class="nav-item me-3">
          <button type="button" class="btn btn-outline-light" onclick="location.href='/login/'">Log In</button>
        </li>
      </ul>
    </div>
  </nav>
  <div class="section default-bg">
    <div class="main">
      <div class="info animateLeftDisabled hidden animatable">
        <h1>
          Welcome to Soc<span
            style="background: linear-gradient(to right, #e9f9f9, #96e7e7, #30e5e5,#23c4c4); -webkit-text-fill-color: transparent;-webkit-background-clip: text; background-clip: text;">iAlly</span>
        </h1>
        <article class="content">
          Ever wanted to have a more seemless experience in partaking in social work? Well you're at the right place!
          With SociAlly you can sign up for events, track your progress and even register to stage your own events. Find
          your perfect fit, simplify collaboration, and make a real difference together.
        </article>
      </div>
      <img src="img/beach-clean-up.jpg" class="hidden animateRightDisabled animatable" alt="" />
    </div>
  </div>
  <div class="section white-bg">
    <div class="main white-bg">
      <div class="info animateRightDisabled hidden animatable">
        <h1>
          Connect, Collaborate, Create Change.
        </h1>
        <article class="content">
          At SociAlly, we believe in the transformative power of volunteerism. We connect passionate individuals with
          inspiring NGOs, fostering meaningful partnerships that create positive change in our communities.
        </article>
      </div>
      <img src="img/ngo-teaching.jpg" class="hidden animateLeftDisabled animatable" alt="" />
    </div>
  </div>
  <!--our goal-->
  <!---->

  <div class="our-goal">
    <h1 class="goal">OUR FEATURES</h1>
    <div class="features">
      <div class="row me-auto">
        <div class="col-4" id="feature-box">
          <i class="bi bi-person-arms-up"></i>
          <h3 id="feature-heading">Find your people.</h3>
          <p class="feature-info">Collaborate with fellow social workers!</p>
        </div>
        <div class="col-4" id="feature-box">
          <i class="bi bi-search"></i>
          <h3 id="feature-heading">Find NGO's Near You</h3>
          <p class="feature-info">
            Tired of searching an NGO near you? We'll do it for you.
          </p>
        </div>
        <div class="col-4" id="feature-box">
          <i class="bi bi-heart-fill" id="icon"></i>
          <h3 id="feature-heading">Rewards</h3>
          <p class="feature-info">
            Get exciting certifications and level up on the leaderboard!
          </p>
        </div>
      </div>
    </div>
  </div>

  <body class="show-chatbot">
    <button class="chatbot-toggler">
      <i class="material-symbols-outlined">
        chat
      </i>
    </button>
    <button class="chatbot-toggler">
      <i class="material-symbols-outlined">
        chat
      </i>
    </button>
    <div class="chatbot">
      <header>
        <h2>NGO Helper</h2>
      </header>
      <ul class="chatbox">
        <li class="chat incoming">
          <i class="material-icons">smart_toy</i>
          <p>Hi there <br>How can I help you today?</p>
        </li>
      </ul>
      <div class="chat-input" style="display: flex; align-items: center;">
        <input type="text" id="prompt" name="prompt" required
          style="flex: 1; padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px;">
        <div style="display: flex; flex-direction: column; margin-left: 10px;">
          <input type="file" id="imageUpload" accept="image/*" style="margin-bottom: 5px; display: none;">
          <label for="imageUpload"
            style="background-color: #4CAF50; border: none; color: white; padding: 5px 10px; text-align: center; text-decoration: none; font-size: 14px; cursor: pointer; border-radius: 5px; display: inline-block;">Upload</label>
          <div style="margin-top: 5px;"></div>
          <button type="submit" id="fetchButton"
            style="background-color: #4CAF50; border: none; color: white; padding: 5px 10px; text-align: center; text-decoration: none; font-size: 14px; cursor: pointer; border-radius: 5px;">Send</button>
        </div>
      </div>



    </div>
    <div id="loader">
      <p>hold on</p>
    </div>
    <script src="/commonmark.min.js"></script>

    <script src="js/Homescript.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"
      integrity="sha384-mZLF4UVrpi/QTWPA7BjNPEnkIfRFn4ZEO3Qt/HFklTJBj/gBOV8G3HcKn4NfQblz"
      crossorigin="anonymous"></script>

    <script>
      const chatbox = document.querySelector('.chatbox');

      const showOptions = () => {
        const loginOptions = document.querySelector('.login-options');
        if (loginOptions.style.display == "flex") {
          loginOptions.style.display = "none";
          return;
        }
        loginOptions.style.display = "flex";
      }




      const fetchButton = document.getElementById("fetchButton");
      const contentDiv = document.getElementById("content");
      const loader = document.getElementById('loader');
      const imageUpload = document.getElementById('imageUpload');
      let base64String;
      imageUpload.addEventListener('change', function () {
        const file = this.files[0];
        const reader = new FileReader();

        reader.onloadend = function () {
          base64String = reader.result.replace('data:', '').replace(/^.+,/, '');
          currentImage = base64String;
          const uploadLabel = document.querySelector('label[for="imageUpload"]');
          if (uploadLabel) {
            uploadLabel.textContent = "Uploaded";
          }
        };

        if (file) {
          reader.readAsDataURL(file);
        }
      });

      let currentImage = null;

      let partialResponseBuffer = '';
      let isFirstPart = true;

      const appendUserInput = (input, image) => {
        const newBubble = document.createElement('li');
        newBubble.classList.add('chat', 'outgoing');
        let content = `<div class="message">${input}</div>`;
        if (image) {
          content += `<img src="data:image/jpeg;base64,${image}" alt="User Image" style="max-width: 100%; max-height: 200px; margin-top: 10px;" />`;
          currentImage = image;
        }
        newBubble.innerHTML = content;
        chatbox.appendChild(newBubble);
      };

      const appendBotResponse = (response) => {
        const newBubble = document.createElement('li');
        newBubble.classList.add('chat', 'incoming');
        newBubble.innerHTML = `<i class="material-icons">smart_toy</i><div class="message">${response}</div>`;
        chatbox.appendChild(newBubble);
      };
      const parser = new commonmark.Parser();

      const handleResponse = (response) => {
        if (response.trim() !== "hope this is useful :)") {
          const lastBubble = chatbox.lastElementChild;
          if (lastBubble && lastBubble.classList.contains('incoming')) {
            const messageDiv = lastBubble.querySelector('.message');
            const parsedHTML = parseMarkdownToHTML(response);
            messageDiv.innerHTML += Array.isArray(parsedHTML) ? parsedHTML.join('') : parsedHTML;
          } else {
            const newBubble = document.createElement('li');
            newBubble.classList.add('chat', 'incoming');
            const parsedHTML = parseMarkdownToHTML(response);
            newBubble.innerHTML = `<i class="material-icons">smart_toy</i><div class="message">${Array.isArray(parsedHTML) ? parsedHTML.join('') : parsedHTML}</div>`;
            chatbox.appendChild(newBubble);
          }
        }
      };


      const parseMarkdownToHTML = (markdown) => {
        const parsed = parser.parse(markdown);

        const renderer = new commonmark.HtmlRenderer();

        const htmlContent = renderer.render(parsed);

        return htmlContent;
      };




      document.addEventListener("DOMContentLoaded", function () {
        const chatbotTogglers = document.querySelectorAll(".chatbot-toggler");
        const chatbot = document.querySelector(".chatbot");

        chatbotTogglers.forEach(function (toggler) {
          toggler.addEventListener("click", function () {
            chatbot.classList.toggle("show-chatbot");
            document.body.classList.toggle("show-chatbot");
          });
        });
      });

      fetchButton.addEventListener("click", async () => {
        const userInput = document.getElementById("prompt").value.trim();
        if (!userInput) {
          return;
        }

        currentImage = base64String;
        appendUserInput(userInput, currentImage);
        document.getElementById("prompt").value = '';
        base64String = null;

        const socket = io("https://geminiapi-9rsv.onrender.com");
        socket.on('connect', () => {
          loader.style.display = 'block';
        });

        socket.on("content", (data) => {
          try {
            loader.style.display = 'none';
            handleResponse(data);
          } catch (error) {
            console.error('Error processing data:', error);
          }
        });
        const uploadLabel = document.querySelector('label[for="imageUpload"]');
        if (uploadLabel) {
          uploadLabel.textContent = "Upload";
        }
        socket.on('disconnect', function () {
          //console.log('Server has disconnected');
        });
        const response = await fetch("https://geminiapi-9rsv.onrender.com/generate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            prompt: userInput,
            base64Image: currentImage,
          }),
        });
        const data = await response.json();

      });
    </script>
  </body>

</html>